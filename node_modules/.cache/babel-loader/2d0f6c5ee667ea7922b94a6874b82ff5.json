{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { withMap } from './context';\nvar Source = function (_super) {\n  __extends(Source, _super);\n  function Source() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.id = _this.props.id;\n    _this.onStyleDataChange = function () {\n      if (!_this.props.map.getLayer(_this.id)) {\n        _this.initialize();\n        _this.forceUpdate();\n      }\n    };\n    _this.initialize = function () {\n      var map = _this.props.map;\n      var _a = _this.props,\n        geoJsonSource = _a.geoJsonSource,\n        tileJsonSource = _a.tileJsonSource,\n        onSourceAdded = _a.onSourceAdded;\n      if (!map.getSource(_this.id) && (geoJsonSource || tileJsonSource)) {\n        if (geoJsonSource) {\n          map.addSource(_this.id, geoJsonSource);\n        } else if (tileJsonSource) {\n          map.addSource(_this.id, tileJsonSource);\n        }\n        map.on('sourcedata', _this.onData);\n        if (onSourceAdded) {\n          onSourceAdded(map.getSource(_this.id));\n        }\n      }\n    };\n    _this.onData = function () {\n      var map = _this.props.map;\n      var source = map.getSource(_this.props.id);\n      if (!source || !map.isSourceLoaded(_this.props.id)) {\n        return;\n      }\n      var onSourceLoaded = _this.props.onSourceLoaded;\n      if (source && onSourceLoaded) {\n        onSourceLoaded(source);\n      }\n      if (source && _this.props.geoJsonSource && _this.props.geoJsonSource.data) {\n        source.setData(_this.props.geoJsonSource.data);\n      }\n      map.off('sourcedata', _this.onData);\n    };\n    return _this;\n  }\n  Source.prototype.UNSAFE_componentWillMount = function () {\n    var map = this.props.map;\n    map.on('styledata', this.onStyleDataChange);\n    this.initialize();\n  };\n  Source.prototype.removeSource = function () {\n    var _this = this;\n    var map = this.props.map;\n    if (map.getSource(this.id)) {\n      var _a = map.getStyle().layers,\n        layers_1 = _a === void 0 ? [] : _a;\n      layers_1 = layers_1.map(function (layer, idx) {\n        var before = (layers_1[idx + 1] || {\n          id: undefined\n        }).id;\n        return __assign({}, layer, {\n          before: before\n        });\n      }).filter(function (layer) {\n        return layer.source === _this.id;\n      });\n      layers_1.forEach(function (layer) {\n        return map.removeLayer(layer.id);\n      });\n      map.removeSource(this.id);\n      return layers_1.reverse();\n    }\n    return [];\n  };\n  Source.prototype.componentWillUnmount = function () {\n    var map = this.props.map;\n    if (!map || !map.getStyle()) {\n      return;\n    }\n    map.off('styledata', this.onStyleDataChange);\n    this.removeSource();\n  };\n  Source.prototype.UNSAFE_componentWillReceiveProps = function (props) {\n    var _a = this.props,\n      geoJsonSource = _a.geoJsonSource,\n      tileJsonSource = _a.tileJsonSource,\n      map = _a.map;\n    if (tileJsonSource && props.tileJsonSource) {\n      var hasNewTilesSource = tileJsonSource.url !== props.tileJsonSource.url || tileJsonSource.tiles !== props.tileJsonSource.tiles || tileJsonSource.minzoom !== props.tileJsonSource.minzoom || tileJsonSource.maxzoom !== props.tileJsonSource.maxzoom;\n      if (hasNewTilesSource) {\n        var layers = this.removeSource();\n        map.addSource(this.id, props.tileJsonSource);\n        layers.forEach(function (layer) {\n          return map.addLayer(layer, layer.before);\n        });\n      }\n    }\n    if (geoJsonSource && props.geoJsonSource && props.geoJsonSource.data !== geoJsonSource.data && props.geoJsonSource.data && map.getSource(this.id)) {\n      var source = map.getSource(this.id);\n      source.setData(props.geoJsonSource.data);\n    }\n  };\n  Source.prototype.render = function () {\n    return null;\n  };\n  return Source;\n}(React.Component);\nexport { Source };\nexport default withMap(Source);","map":{"version":3,"sources":["../src/source.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { withMap } from './context';\nvar Source = (function (_super) {\n    __extends(Source, _super);\n    function Source() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.id = _this.props.id;\n        _this.onStyleDataChange = function () {\n            if (!_this.props.map.getLayer(_this.id)) {\n                _this.initialize();\n                _this.forceUpdate();\n            }\n        };\n        _this.initialize = function () {\n            var map = _this.props.map;\n            var _a = _this.props, geoJsonSource = _a.geoJsonSource, tileJsonSource = _a.tileJsonSource, onSourceAdded = _a.onSourceAdded;\n            if (!map.getSource(_this.id) && (geoJsonSource || tileJsonSource)) {\n                if (geoJsonSource) {\n                    map.addSource(_this.id, geoJsonSource);\n                }\n                else if (tileJsonSource) {\n                    map.addSource(_this.id, tileJsonSource);\n                }\n                map.on('sourcedata', _this.onData);\n                if (onSourceAdded) {\n                    onSourceAdded(map.getSource(_this.id));\n                }\n            }\n        };\n        _this.onData = function () {\n            var map = _this.props.map;\n            var source = map.getSource(_this.props.id);\n            if (!source || !map.isSourceLoaded(_this.props.id)) {\n                return;\n            }\n            var onSourceLoaded = _this.props.onSourceLoaded;\n            if (source && onSourceLoaded) {\n                onSourceLoaded(source);\n            }\n            if (source && _this.props.geoJsonSource && _this.props.geoJsonSource.data) {\n                source.setData(_this.props.geoJsonSource.data);\n            }\n            map.off('sourcedata', _this.onData);\n        };\n        return _this;\n    }\n    Source.prototype.UNSAFE_componentWillMount = function () {\n        var map = this.props.map;\n        map.on('styledata', this.onStyleDataChange);\n        this.initialize();\n    };\n    Source.prototype.removeSource = function () {\n        var _this = this;\n        var map = this.props.map;\n        if (map.getSource(this.id)) {\n            var _a = map.getStyle().layers, layers_1 = _a === void 0 ? [] : _a;\n            layers_1 = layers_1\n                .map(function (layer, idx) {\n                var before = (layers_1[idx + 1] || { id: undefined }).id;\n                return __assign({}, layer, { before: before });\n            })\n                .filter(function (layer) { return layer.source === _this.id; });\n            layers_1.forEach(function (layer) { return map.removeLayer(layer.id); });\n            map.removeSource(this.id);\n            return layers_1.reverse();\n        }\n        return [];\n    };\n    Source.prototype.componentWillUnmount = function () {\n        var map = this.props.map;\n        if (!map || !map.getStyle()) {\n            return;\n        }\n        map.off('styledata', this.onStyleDataChange);\n        this.removeSource();\n    };\n    Source.prototype.UNSAFE_componentWillReceiveProps = function (props) {\n        var _a = this.props, geoJsonSource = _a.geoJsonSource, tileJsonSource = _a.tileJsonSource, map = _a.map;\n        if (tileJsonSource && props.tileJsonSource) {\n            var hasNewTilesSource = tileJsonSource.url !== props.tileJsonSource.url ||\n                tileJsonSource.tiles !== props.tileJsonSource.tiles ||\n                tileJsonSource.minzoom !== props.tileJsonSource.minzoom ||\n                tileJsonSource.maxzoom !== props.tileJsonSource.maxzoom;\n            if (hasNewTilesSource) {\n                var layers = this.removeSource();\n                map.addSource(this.id, props.tileJsonSource);\n                layers.forEach(function (layer) { return map.addLayer(layer, layer.before); });\n            }\n        }\n        if (geoJsonSource &&\n            props.geoJsonSource &&\n            props.geoJsonSource.data !== geoJsonSource.data &&\n            props.geoJsonSource.data &&\n            map.getSource(this.id)) {\n            var source = map.getSource(this.id);\n            source.setData(props.geoJsonSource.data);\n        }\n    };\n    Source.prototype.render = function () {\n        return null;\n    };\n    return Source;\n}(React.Component));\nexport { Source };\nexport default withMap(Source);\n//# sourceMappingURL=source.js.map"]},"metadata":{},"sourceType":"module"}