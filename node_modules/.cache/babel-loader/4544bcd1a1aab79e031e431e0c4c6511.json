{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nvar isEqual = require('deep-equal');\nimport diff from './util/diff';\nvar eventToHandler = {\n  touchstart: 'onTouchStart',\n  touchend: 'onTouchEnd',\n  touchcancel: 'onTouchCancel',\n  mousemove: 'onMouseMove',\n  mouseenter: 'onMouseEnter',\n  mouseleave: 'onMouseLeave',\n  mousedown: 'onMouseDown',\n  mouseup: 'onMouseUp',\n  click: 'onClick'\n};\nvar Layer = function (_super) {\n  __extends(Layer, _super);\n  function Layer() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.source = __assign({\n      type: 'geojson'\n    }, _this.props.geoJSONSourceOptions, {\n      data: {\n        type: 'FeatureCollection',\n        features: []\n      }\n    });\n    _this.geometry = function (coordinates) {\n      switch (_this.props.type) {\n        case 'symbol':\n        case 'circle':\n          return {\n            type: 'Point',\n            coordinates: coordinates\n          };\n        case 'fill':\n          if (Array.isArray(coordinates[0][0][0])) {\n            return {\n              type: 'MultiPolygon',\n              coordinates: coordinates\n            };\n          }\n          return {\n            type: 'Polygon',\n            coordinates: coordinates\n          };\n        case 'line':\n          return {\n            type: 'LineString',\n            coordinates: coordinates\n          };\n        default:\n          return {\n            type: 'Point',\n            coordinates: coordinates\n          };\n      }\n    };\n    _this.makeFeature = function (props, id) {\n      return {\n        type: 'Feature',\n        geometry: _this.geometry(props.coordinates),\n        properties: __assign({}, props.properties, {\n          id: id\n        })\n      };\n    };\n    _this.initialize = function () {\n      var _a = _this.props,\n        type = _a.type,\n        layout = _a.layout,\n        paint = _a.paint,\n        sourceId = _a.sourceId,\n        before = _a.before,\n        images = _a.images,\n        id = _a.id,\n        metadata = _a.metadata,\n        sourceLayer = _a.sourceLayer,\n        minZoom = _a.minZoom,\n        maxZoom = _a.maxZoom,\n        filter = _a.filter;\n      var map = _this.props.map;\n      var layer = {\n        id: id,\n        source: sourceId || id,\n        type: type,\n        layout: layout,\n        paint: paint,\n        metadata: metadata\n      };\n      if (sourceLayer) {\n        layer['source-layer'] = sourceLayer;\n      }\n      if (minZoom) {\n        layer.minzoom = minZoom;\n      }\n      if (maxZoom) {\n        layer.maxzoom = maxZoom;\n      }\n      if (filter) {\n        layer.filter = filter;\n      }\n      if (images) {\n        var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n        normalizedImages.filter(function (image) {\n          return !map.hasImage(image[0]);\n        }).forEach(function (image) {\n          map.addImage(image[0], image[1], image[2]);\n        });\n      }\n      if (!sourceId && !map.getSource(id)) {\n        map.addSource(id, _this.source);\n      }\n      if (!map.getLayer(id)) {\n        map.addLayer(layer, before);\n      }\n      Object.entries(eventToHandler).forEach(function (_a) {\n        var event = _a[0],\n          propName = _a[1];\n        var handler = _this.props[propName];\n        if (handler) {\n          map.on(event, id, handler);\n        }\n      });\n    };\n    _this.onStyleDataChange = function () {\n      if (!_this.props.map.getLayer(_this.props.id)) {\n        _this.initialize();\n        _this.forceUpdate();\n      }\n    };\n    _this.getChildren = function () {\n      var children = _this.props.children;\n      if (!children) {\n        return [];\n      }\n      if (Array.isArray(children)) {\n        return children.reduce(function (arr, next) {\n          return arr.concat(next);\n        }, []);\n      }\n      return [children];\n    };\n    return _this;\n  }\n  Layer.prototype.UNSAFE_componentWillMount = function () {\n    var map = this.props.map;\n    this.initialize();\n    map.on('styledata', this.onStyleDataChange);\n  };\n  Layer.prototype.componentWillUnmount = function () {\n    var _this = this;\n    var map = this.props.map;\n    var _a = this.props,\n      images = _a.images,\n      id = _a.id;\n    if (!map || !map.getStyle()) {\n      return;\n    }\n    map.off('styledata', this.onStyleDataChange);\n    Object.entries(eventToHandler).forEach(function (_a) {\n      var event = _a[0],\n        propName = _a[1];\n      var handler = _this.props[propName];\n      if (handler) {\n        map.off(event, id, handler);\n      }\n    });\n    if (map.getLayer(id)) {\n      map.removeLayer(id);\n    }\n    if (!this.props.sourceId) {\n      map.removeSource(id);\n    }\n    if (images) {\n      var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n      normalizedImages.map(function (_a) {\n        var key = _a[0],\n          rest = _a.slice(1);\n        return key;\n      }).forEach(map.removeImage.bind(map));\n    }\n  };\n  Layer.prototype.UNSAFE_componentWillReceiveProps = function (props) {\n    var _this = this;\n    var _a = this.props,\n      paint = _a.paint,\n      layout = _a.layout,\n      before = _a.before,\n      filter = _a.filter,\n      id = _a.id,\n      minZoom = _a.minZoom,\n      maxZoom = _a.maxZoom;\n    var map = this.props.map;\n    if (!isEqual(props.paint, paint)) {\n      var paintDiff_1 = diff(paint, props.paint);\n      Object.keys(paintDiff_1).forEach(function (key) {\n        map.setPaintProperty(id, key, paintDiff_1[key]);\n      });\n    }\n    if (!isEqual(props.layout, layout)) {\n      var layoutDiff_1 = diff(layout, props.layout);\n      Object.keys(layoutDiff_1).forEach(function (key) {\n        map.setLayoutProperty(id, key, layoutDiff_1[key]);\n      });\n    }\n    if (!isEqual(props.filter, filter)) {\n      map.setFilter(id, props.filter);\n    }\n    if (before !== props.before) {\n      map.moveLayer(id, props.before);\n    }\n    if (minZoom !== props.minZoom || maxZoom !== props.maxZoom) {\n      map.setLayerZoomRange(id, props.minZoom, props.maxZoom);\n    }\n    Object.entries(eventToHandler).forEach(function (_a) {\n      var event = _a[0],\n        propName = _a[1];\n      var oldHandler = _this.props[propName];\n      var newHandler = props[propName];\n      if (oldHandler !== newHandler) {\n        if (oldHandler) {\n          map.off(event, id, oldHandler);\n        }\n        if (newHandler) {\n          map.on(event, id, newHandler);\n        }\n      }\n    });\n  };\n  Layer.prototype.render = function () {\n    var _this = this;\n    var map = this.props.map;\n    var _a = this.props,\n      sourceId = _a.sourceId,\n      draggedChildren = _a.draggedChildren;\n    var children = this.getChildren();\n    if (draggedChildren) {\n      var draggableChildrenIds_1 = draggedChildren.map(function (child) {\n        return child.key;\n      });\n      children = children.map(function (child) {\n        var indexChildren = draggableChildrenIds_1.indexOf(child.key);\n        if (indexChildren !== -1) {\n          return draggedChildren[indexChildren];\n        }\n        return child;\n      });\n    }\n    var features = children.map(function (_a, id) {\n      var props = _a.props;\n      return _this.makeFeature(props, id);\n    }).filter(Boolean);\n    var source = map.getSource(sourceId || this.props.id);\n    if (source && !sourceId && source.setData) {\n      source.setData({\n        type: 'FeatureCollection',\n        features: features\n      });\n    }\n    return null;\n  };\n  Layer.defaultProps = {\n    type: 'symbol',\n    layout: {},\n    paint: {}\n  };\n  return Layer;\n}(React.Component);\nexport default Layer;","map":{"version":3,"sources":["../src/layer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nvar isEqual = require('deep-equal');\nimport diff from './util/diff';\nvar eventToHandler = {\n    touchstart: 'onTouchStart',\n    touchend: 'onTouchEnd',\n    touchcancel: 'onTouchCancel',\n    mousemove: 'onMouseMove',\n    mouseenter: 'onMouseEnter',\n    mouseleave: 'onMouseLeave',\n    mousedown: 'onMouseDown',\n    mouseup: 'onMouseUp',\n    click: 'onClick'\n};\nvar Layer = (function (_super) {\n    __extends(Layer, _super);\n    function Layer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.source = __assign({ type: 'geojson' }, _this.props.geoJSONSourceOptions, { data: {\n                type: 'FeatureCollection',\n                features: []\n            } });\n        _this.geometry = function (coordinates) {\n            switch (_this.props.type) {\n                case 'symbol':\n                case 'circle':\n                    return {\n                        type: 'Point',\n                        coordinates: coordinates\n                    };\n                case 'fill':\n                    if (Array.isArray(coordinates[0][0][0])) {\n                        return {\n                            type: 'MultiPolygon',\n                            coordinates: coordinates\n                        };\n                    }\n                    return {\n                        type: 'Polygon',\n                        coordinates: coordinates\n                    };\n                case 'line':\n                    return {\n                        type: 'LineString',\n                        coordinates: coordinates\n                    };\n                default:\n                    return {\n                        type: 'Point',\n                        coordinates: coordinates\n                    };\n            }\n        };\n        _this.makeFeature = function (props, id) { return ({\n            type: 'Feature',\n            geometry: _this.geometry(props.coordinates),\n            properties: __assign({}, props.properties, { id: id })\n        }); };\n        _this.initialize = function () {\n            var _a = _this.props, type = _a.type, layout = _a.layout, paint = _a.paint, sourceId = _a.sourceId, before = _a.before, images = _a.images, id = _a.id, metadata = _a.metadata, sourceLayer = _a.sourceLayer, minZoom = _a.minZoom, maxZoom = _a.maxZoom, filter = _a.filter;\n            var map = _this.props.map;\n            var layer = {\n                id: id,\n                source: sourceId || id,\n                type: type,\n                layout: layout,\n                paint: paint,\n                metadata: metadata\n            };\n            if (sourceLayer) {\n                layer['source-layer'] = sourceLayer;\n            }\n            if (minZoom) {\n                layer.minzoom = minZoom;\n            }\n            if (maxZoom) {\n                layer.maxzoom = maxZoom;\n            }\n            if (filter) {\n                layer.filter = filter;\n            }\n            if (images) {\n                var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n                normalizedImages\n                    .filter(function (image) { return !map.hasImage(image[0]); })\n                    .forEach(function (image) {\n                    map.addImage(image[0], image[1], image[2]);\n                });\n            }\n            if (!sourceId && !map.getSource(id)) {\n                map.addSource(id, _this.source);\n            }\n            if (!map.getLayer(id)) {\n                map.addLayer(layer, before);\n            }\n            Object.entries(eventToHandler).forEach(function (_a) {\n                var event = _a[0], propName = _a[1];\n                var handler = _this.props[propName];\n                if (handler) {\n                    map.on(event, id, handler);\n                }\n            });\n        };\n        _this.onStyleDataChange = function () {\n            if (!_this.props.map.getLayer(_this.props.id)) {\n                _this.initialize();\n                _this.forceUpdate();\n            }\n        };\n        _this.getChildren = function () {\n            var children = _this.props.children;\n            if (!children) {\n                return [];\n            }\n            if (Array.isArray(children)) {\n                return children.reduce(function (arr, next) { return arr.concat(next); }, []);\n            }\n            return [children];\n        };\n        return _this;\n    }\n    Layer.prototype.UNSAFE_componentWillMount = function () {\n        var map = this.props.map;\n        this.initialize();\n        map.on('styledata', this.onStyleDataChange);\n    };\n    Layer.prototype.componentWillUnmount = function () {\n        var _this = this;\n        var map = this.props.map;\n        var _a = this.props, images = _a.images, id = _a.id;\n        if (!map || !map.getStyle()) {\n            return;\n        }\n        map.off('styledata', this.onStyleDataChange);\n        Object.entries(eventToHandler).forEach(function (_a) {\n            var event = _a[0], propName = _a[1];\n            var handler = _this.props[propName];\n            if (handler) {\n                map.off(event, id, handler);\n            }\n        });\n        if (map.getLayer(id)) {\n            map.removeLayer(id);\n        }\n        if (!this.props.sourceId) {\n            map.removeSource(id);\n        }\n        if (images) {\n            var normalizedImages = !Array.isArray(images[0]) ? [images] : images;\n            normalizedImages\n                .map(function (_a) {\n                var key = _a[0], rest = _a.slice(1);\n                return key;\n            })\n                .forEach(map.removeImage.bind(map));\n        }\n    };\n    Layer.prototype.UNSAFE_componentWillReceiveProps = function (props) {\n        var _this = this;\n        var _a = this.props, paint = _a.paint, layout = _a.layout, before = _a.before, filter = _a.filter, id = _a.id, minZoom = _a.minZoom, maxZoom = _a.maxZoom;\n        var map = this.props.map;\n        if (!isEqual(props.paint, paint)) {\n            var paintDiff_1 = diff(paint, props.paint);\n            Object.keys(paintDiff_1).forEach(function (key) {\n                map.setPaintProperty(id, key, paintDiff_1[key]);\n            });\n        }\n        if (!isEqual(props.layout, layout)) {\n            var layoutDiff_1 = diff(layout, props.layout);\n            Object.keys(layoutDiff_1).forEach(function (key) {\n                map.setLayoutProperty(id, key, layoutDiff_1[key]);\n            });\n        }\n        if (!isEqual(props.filter, filter)) {\n            map.setFilter(id, props.filter);\n        }\n        if (before !== props.before) {\n            map.moveLayer(id, props.before);\n        }\n        if (minZoom !== props.minZoom || maxZoom !== props.maxZoom) {\n            map.setLayerZoomRange(id, props.minZoom, props.maxZoom);\n        }\n        Object.entries(eventToHandler).forEach(function (_a) {\n            var event = _a[0], propName = _a[1];\n            var oldHandler = _this.props[propName];\n            var newHandler = props[propName];\n            if (oldHandler !== newHandler) {\n                if (oldHandler) {\n                    map.off(event, id, oldHandler);\n                }\n                if (newHandler) {\n                    map.on(event, id, newHandler);\n                }\n            }\n        });\n    };\n    Layer.prototype.render = function () {\n        var _this = this;\n        var map = this.props.map;\n        var _a = this.props, sourceId = _a.sourceId, draggedChildren = _a.draggedChildren;\n        var children = this.getChildren();\n        if (draggedChildren) {\n            var draggableChildrenIds_1 = draggedChildren.map(function (child) { return child.key; });\n            children = children.map(function (child) {\n                var indexChildren = draggableChildrenIds_1.indexOf(child.key);\n                if (indexChildren !== -1) {\n                    return draggedChildren[indexChildren];\n                }\n                return child;\n            });\n        }\n        var features = children\n            .map(function (_a, id) {\n            var props = _a.props;\n            return _this.makeFeature(props, id);\n        })\n            .filter(Boolean);\n        var source = map.getSource(sourceId || this.props.id);\n        if (source && !sourceId && source.setData) {\n            source.setData({\n                type: 'FeatureCollection',\n                features: features\n            });\n        }\n        return null;\n    };\n    Layer.defaultProps = {\n        type: 'symbol',\n        layout: {},\n        paint: {}\n    };\n    return Layer;\n}(React.Component));\nexport default Layer;\n//# sourceMappingURL=layer.js.map"]},"metadata":{},"sourceType":"module"}