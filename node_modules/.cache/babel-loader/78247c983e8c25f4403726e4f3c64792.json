{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { generateID } from './util/uid';\nexport function layerMouseTouchEvents(WrappedComponent) {\n  return function (_super) {\n    __extends(EnhancedLayer, _super);\n    function EnhancedLayer() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n      _this.hover = [];\n      _this.draggedChildren = undefined;\n      _this.id = _this.props.id || \"layer-\" + generateID();\n      _this.getChildren = function () {\n        return [].concat(_this.props.children).filter(function (el) {\n          return typeof el !== 'undefined';\n        });\n      };\n      _this.getChildFromId = function (children, id) {\n        return children[id];\n      };\n      _this.areFeaturesDraggable = function (children, featureIds) {\n        if (featureIds === void 0) {\n          featureIds = _this.hover;\n        }\n        return !!featureIds.map(function (id) {\n          return _this.getChildFromId(children, id) ? _this.getChildFromId(children, id).props.draggable : false;\n        }).filter(Boolean).length;\n      };\n      _this.onClick = function (evt) {\n        var features = evt.features;\n        var children = _this.getChildren();\n        var map = _this.props.map;\n        if (features) {\n          features.forEach(function (feature) {\n            var id = feature.properties.id;\n            if (children) {\n              var child = _this.getChildFromId(children, id);\n              var onClick = child && child.props.onClick;\n              if (onClick) {\n                onClick(__assign({}, evt, {\n                  feature: feature,\n                  map: map\n                }));\n              }\n            }\n          });\n        }\n      };\n      _this.onMouseEnter = function (evt) {\n        var children = _this.getChildren();\n        var map = _this.props.map;\n        _this.hover = [];\n        evt.features.forEach(function (feature) {\n          var id = feature.properties.id;\n          var child = _this.getChildFromId(children, id);\n          _this.hover.push(id);\n          var onMouseEnter = child && child.props.onMouseEnter;\n          if (onMouseEnter) {\n            onMouseEnter(__assign({}, evt, {\n              feature: feature,\n              map: map\n            }));\n          }\n        });\n        if (_this.areFeaturesDraggable(children)) {\n          map.dragPan.disable();\n        }\n      };\n      _this.onMouseLeave = function (evt) {\n        var children = _this.getChildren();\n        var map = _this.props.map;\n        if (_this.areFeaturesDraggable(children)) {\n          map.dragPan.enable();\n        }\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n          var onMouseLeave = child && child.props.onMouseLeave;\n          if (onMouseLeave) {\n            onMouseLeave(__assign({}, evt, {\n              map: map\n            }));\n          }\n        });\n        if (!_this.draggedChildren) {\n          _this.hover = [];\n        }\n      };\n      _this.onMouseDown = function () {\n        if (_this.hover.length) {\n          _this.onFeatureDown('mousedown');\n        }\n      };\n      _this.onTouchStart = function (evt) {\n        _this.hover = evt.features.map(function (feature) {\n          return feature.properties.id;\n        });\n        if (_this.hover.length) {\n          _this.onFeatureDown('touchstart');\n        }\n      };\n      _this.onFeatureDown = function (startEvent) {\n        var moveEvent = startEvent === 'mousedown' ? 'mousemove' : 'touchmove';\n        var endEvent = startEvent === 'mousedown' ? 'mouseup' : 'touchend';\n        var map = _this.props.map;\n        map.once(moveEvent, _this.onFeatureDragStart);\n        map.on(moveEvent, _this.onFeatureDrag);\n        map.once(endEvent, function (evt) {\n          map.off(moveEvent, _this.onFeatureDragStart);\n          map.off(moveEvent, _this.onFeatureDrag);\n          _this.onFeatureDragEnd(evt);\n        });\n      };\n      _this.onFeatureDragStart = function (evt) {\n        var map = _this.props.map;\n        var children = _this.getChildren();\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n          if (child && !child.props.draggable) {\n            return;\n          }\n          var onDragStart = child && child.props.onDragStart;\n          if (onDragStart) {\n            onDragStart(__assign({}, evt, {\n              map: map\n            }));\n          }\n        });\n      };\n      _this.onFeatureDrag = function (evt) {\n        var children = _this.getChildren();\n        var map = _this.props.map;\n        var _a = evt.lngLat,\n          lng = _a.lng,\n          lat = _a.lat;\n        _this.draggedChildren = [];\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n          var onDrag = child && child.props.onDrag;\n          if (child && child.props.draggable) {\n            _this.draggedChildren.push(React.cloneElement(child, {\n              coordinates: [lng, lat]\n            }));\n            if (onDrag) {\n              onDrag(__assign({}, evt, {\n                map: map\n              }));\n            }\n          }\n        });\n        _this.forceUpdate();\n      };\n      _this.onFeatureDragEnd = function (evt) {\n        var map = _this.props.map;\n        var children = _this.getChildren();\n        _this.hover.forEach(function (id) {\n          var child = _this.getChildFromId(children, id);\n          var onDragEnd = child && child.props.onDragEnd;\n          if (onDragEnd && child.props.draggable && _this.draggedChildren) {\n            onDragEnd(__assign({}, evt, {\n              map: map\n            }));\n          }\n        });\n        _this.draggedChildren = undefined;\n      };\n      return _this;\n    }\n    EnhancedLayer.prototype.UNSAFE_componentWillMount = function () {\n      var map = this.props.map;\n      map.on('click', this.id, this.onClick);\n      map.on('mouseenter', this.id, this.onMouseEnter);\n      map.on('mouseleave', this.id, this.onMouseLeave);\n      map.on('mousedown', this.id, this.onMouseDown);\n      map.on('touchstart', this.id, this.onTouchStart);\n    };\n    EnhancedLayer.prototype.componentWillUnmount = function () {\n      var map = this.props.map;\n      map.off('click', this.onClick);\n      map.off('mouseenter', this.onMouseEnter);\n      map.off('mouseleave', this.onMouseLeave);\n      map.off('mousedown', this.onMouseDown);\n      map.off('touchstart', this.onTouchStart);\n    };\n    EnhancedLayer.prototype.render = function () {\n      return React.createElement(WrappedComponent, __assign({}, this.props, {\n        id: this.id,\n        map: this.props.map,\n        draggedChildren: this.draggedChildren\n      }));\n    };\n    return EnhancedLayer;\n  }(React.Component);\n}\nexport default layerMouseTouchEvents;","map":{"version":3,"sources":["../src/layer-events-hoc.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { generateID } from './util/uid';\nexport function layerMouseTouchEvents(WrappedComponent) {\n    return (function (_super) {\n        __extends(EnhancedLayer, _super);\n        function EnhancedLayer() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.hover = [];\n            _this.draggedChildren = undefined;\n            _this.id = _this.props.id || \"layer-\" + generateID();\n            _this.getChildren = function () {\n                return []\n                    .concat(_this.props.children)\n                    .filter(function (el) {\n                    return typeof el !== 'undefined';\n                });\n            };\n            _this.getChildFromId = function (children, id) { return children[id]; };\n            _this.areFeaturesDraggable = function (children, featureIds) {\n                if (featureIds === void 0) { featureIds = _this.hover; }\n                return !!featureIds\n                    .map(function (id) {\n                    return _this.getChildFromId(children, id)\n                        ? _this.getChildFromId(children, id).props.draggable\n                        : false;\n                })\n                    .filter(Boolean).length;\n            };\n            _this.onClick = function (evt) {\n                var features = evt.features;\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                if (features) {\n                    features.forEach(function (feature) {\n                        var id = feature.properties.id;\n                        if (children) {\n                            var child = _this.getChildFromId(children, id);\n                            var onClick = child && child.props.onClick;\n                            if (onClick) {\n                                onClick(__assign({}, evt, { feature: feature, map: map }));\n                            }\n                        }\n                    });\n                }\n            };\n            _this.onMouseEnter = function (evt) {\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                _this.hover = [];\n                evt.features.forEach(function (feature) {\n                    var id = feature.properties.id;\n                    var child = _this.getChildFromId(children, id);\n                    _this.hover.push(id);\n                    var onMouseEnter = child && child.props.onMouseEnter;\n                    if (onMouseEnter) {\n                        onMouseEnter(__assign({}, evt, { feature: feature, map: map }));\n                    }\n                });\n                if (_this.areFeaturesDraggable(children)) {\n                    map.dragPan.disable();\n                }\n            };\n            _this.onMouseLeave = function (evt) {\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                if (_this.areFeaturesDraggable(children)) {\n                    map.dragPan.enable();\n                }\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    var onMouseLeave = child && child.props.onMouseLeave;\n                    if (onMouseLeave) {\n                        onMouseLeave(__assign({}, evt, { map: map }));\n                    }\n                });\n                if (!_this.draggedChildren) {\n                    _this.hover = [];\n                }\n            };\n            _this.onMouseDown = function () {\n                if (_this.hover.length) {\n                    _this.onFeatureDown('mousedown');\n                }\n            };\n            _this.onTouchStart = function (evt) {\n                _this.hover = evt.features.map(function (feature) { return feature.properties.id; });\n                if (_this.hover.length) {\n                    _this.onFeatureDown('touchstart');\n                }\n            };\n            _this.onFeatureDown = function (startEvent) {\n                var moveEvent = startEvent === 'mousedown' ? 'mousemove' : 'touchmove';\n                var endEvent = startEvent === 'mousedown' ? 'mouseup' : 'touchend';\n                var map = _this.props.map;\n                map.once(moveEvent, _this.onFeatureDragStart);\n                map.on(moveEvent, _this.onFeatureDrag);\n                map.once(endEvent, function (evt) {\n                    map.off(moveEvent, _this.onFeatureDragStart);\n                    map.off(moveEvent, _this.onFeatureDrag);\n                    _this.onFeatureDragEnd(evt);\n                });\n            };\n            _this.onFeatureDragStart = function (evt) {\n                var map = _this.props.map;\n                var children = _this.getChildren();\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    if (child && !child.props.draggable) {\n                        return;\n                    }\n                    var onDragStart = child && child.props.onDragStart;\n                    if (onDragStart) {\n                        onDragStart(__assign({}, evt, { map: map }));\n                    }\n                });\n            };\n            _this.onFeatureDrag = function (evt) {\n                var children = _this.getChildren();\n                var map = _this.props.map;\n                var _a = evt.lngLat, lng = _a.lng, lat = _a.lat;\n                _this.draggedChildren = [];\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    var onDrag = child && child.props.onDrag;\n                    if (child && child.props.draggable) {\n                        _this.draggedChildren.push(React.cloneElement(child, {\n                            coordinates: [lng, lat]\n                        }));\n                        if (onDrag) {\n                            onDrag(__assign({}, evt, { map: map }));\n                        }\n                    }\n                });\n                _this.forceUpdate();\n            };\n            _this.onFeatureDragEnd = function (evt) {\n                var map = _this.props.map;\n                var children = _this.getChildren();\n                _this.hover.forEach(function (id) {\n                    var child = _this.getChildFromId(children, id);\n                    var onDragEnd = child && child.props.onDragEnd;\n                    if (onDragEnd && child.props.draggable && _this.draggedChildren) {\n                        onDragEnd(__assign({}, evt, { map: map }));\n                    }\n                });\n                _this.draggedChildren = undefined;\n            };\n            return _this;\n        }\n        EnhancedLayer.prototype.UNSAFE_componentWillMount = function () {\n            var map = this.props.map;\n            map.on('click', this.id, this.onClick);\n            map.on('mouseenter', this.id, this.onMouseEnter);\n            map.on('mouseleave', this.id, this.onMouseLeave);\n            map.on('mousedown', this.id, this.onMouseDown);\n            map.on('touchstart', this.id, this.onTouchStart);\n        };\n        EnhancedLayer.prototype.componentWillUnmount = function () {\n            var map = this.props.map;\n            map.off('click', this.onClick);\n            map.off('mouseenter', this.onMouseEnter);\n            map.off('mouseleave', this.onMouseLeave);\n            map.off('mousedown', this.onMouseDown);\n            map.off('touchstart', this.onTouchStart);\n        };\n        EnhancedLayer.prototype.render = function () {\n            return (React.createElement(WrappedComponent, __assign({}, this.props, { id: this.id, map: this.props.map, draggedChildren: this.draggedChildren })));\n        };\n        return EnhancedLayer;\n    }(React.Component));\n}\nexport default layerMouseTouchEvents;\n//# sourceMappingURL=layer-events-hoc.js.map"]},"metadata":{},"sourceType":"module"}